<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Open Graph / WhatsApp Preview -->
    <meta property="og:title" content="¬°Primer a√±ito de Ivy! üéà" />
    <meta property="og:description" content="Entra para ver la lista de regalos y elegir el tuyo. ¬°Gracias por celebrar con nosotros!" />
    <meta property="og:image" content="https://paulamen.github.io/cumple-uno/ivy.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://paulamen.github.io/cumple-uno/" />

    <title>Lista de Regalos - Ivy</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #FFF8E1; color: #333; line-height: 1.6; }
        h1 { text-align: center; color: #E65100; margin-bottom: 5px; font-size: 2.5em; }
        h3 { text-align: center; color: #F57C00; margin-top: 0; font-weight: normal; margin-bottom: 30px; font-size: 1.5em;}
        
        .search-box { text-align: center; margin-bottom: 30px; }
        #buscar { width: 100%; max-width: 500px; padding: 15px 25px; border-radius: 30px; border: 2px solid #FFCC80; font-size: 18px; outline: none; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        #buscar:focus { border-color: #EF6C00; box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        
        /* Grid de Regalos */
        .regalos-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
            max-width: 1200px; 
            margin: 0 auto; 
        }

        .regalo-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #FFCC80;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s;
        }

        .regalo-card:hover {
            transform: translateY(-5px);
        }

        .regalo-nombre {
            color: #E65100;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .regalo-descripcion {
            color: #555;
            margin-bottom: 20px;
            flex-grow: 1;
        }
        
        .btn-elegir { background: #2196F3; color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; font-size: 1em; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.2s; width: 100%; }
        .btn-elegir:hover { background: #1976D2; transform: scale(1.02); }

        @media (max-width: 600px) {
            h1 { font-size: 1.8em; }
            h3 { font-size: 1.2em; }
            body { margin: 15px; }
            .regalos-grid { grid-template-columns: 1fr; }
        }

        /* Modales */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(2px); }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; border-top: 10px solid #FF9800; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: slideUp 0.3s; }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { font-weight: bold; color: #555; display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        input:focus { border-color: #FF9800; outline: none; }

        .btn-confirm { background: #FF9800; color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .btn-confirm:disabled { background-color: #ccc; cursor: not-allowed; }
        .btn-close { float: right; font-size: 24px; cursor: pointer; color: #aaa; }
        
        /* Estilos Pantalla √âxito */
        #success-icon { font-size: 60px; margin-bottom: 15px; }
        .btn-ok { background-color: #4CAF50; color: white; padding: 10px 30px; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; margin-top: 20px;}
        
        #loading { text-align: center; padding: 20px; color: #666; font-style: italic; }
    </style>
</head>
<body>

    <h1>üéà ¬°Primer a√±ito de Ivy! üéà</h1>
    <h3>Lista de Regalos</h3>
    
    <div class="search-box">
        <input type="text" id="buscar" placeholder="üîç Buscar regalo..." oninput="filtrarRegalos()">
    </div>

    <div id="loading">Cargando lista de regalos...</div>

    <div id="regalosContainer" class="regalos-grid" style="display:none;">
    </div>

    <div id="reservaModal" class="modal">
        <div class="modal-content">
            <span class="btn-close" onclick="cerrarModal()">&times;</span>
            <h2 style="color:#E65100; margin-top:0;">Reservar Regalo</h2>
            <p id="nombreRegaloModal" style="color:#888; margin-bottom: 20px;"></p>
            <input type="hidden" id="selectedRegaloId">
            <div class="form-group"><label>Nombre:</label><input type="text" id="nombrePersona" placeholder="Tu nombre"></div>
            <div class="form-group"><label>Correo:</label><input type="email" id="correoPersona" placeholder="tucorreo@ejemplo.com"></div>
            <button class="btn-confirm" onclick="enviarReserva()" id="btnConfirmar">Confirmar Reserva</button>
        </div>
    </div>

    <div id="exitoModal" class="modal">
        <div class="modal-content" style="border-top: 10px solid #4CAF50;">
            <div id="success-icon">‚ú®üéÅ‚ú®</div>
            <h2 style="color:#4CAF50; margin:0;">¬°Reserva Exitosa!</h2>
            <p style="color:#666; font-size: 1.1em; margin-top: 15px; line-height: 1.5;">
                Gracias por el regalo.<br>
                <strong>Revisa tu correo</strong> para ver la confirmaci√≥n.
            </p>
            <button class="btn-ok" onclick="location.reload()">Aceptar</button>
        </div>
    </div>

    <script>
        // üëá PEGA AQU√ç TU URL (la que termina en /exec)
        const API_URL = "https://script.google.com/macros/s/AKfycbx81PAwQx3TWok59XPq6hb__5wm4kLyA_aick2ryBNJUvam0-O835Rb2P4EUJy99Pbg/exec";

        let todosLosRegalos = [];

        window.onload = function() {
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    todosLosRegalos = data;
                    mostrarRegalos(data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('regalosContainer').style.display = 'grid';
                })
                .catch(error => {
                    document.getElementById('loading').innerHTML = "<span style='color:red'>Error cargando datos. Intenta recargar.</span>";
                });
        };

        function mostrarRegalos(lista) {
            const container = document.getElementById('regalosContainer');
            container.innerHTML = '';
            if(lista.length === 0) { container.innerHTML = '<div style="text-align:center; padding: 20px; grid-column: 1/-1;">üéâ No hay regalos disponibles.</div>'; return;}
            
            let html = '';
            lista.forEach(r => {
                html += `
                <div class="regalo-card">
                    <div>
                        <div class="regalo-nombre">${r.nombre}</div>
                        <div class="regalo-descripcion">${r.descripcion}</div>
                    </div>
                    <button class="btn-elegir" onclick="abrirModal('${r.id}', '${r.nombre.replace(/'/g, "\\'")}')">Elegir Regalo</button>
                </div>`;
            });
            container.innerHTML = html;
        }

        function filtrarRegalos() {
            const txt = document.getElementById('buscar').value.toLowerCase();
            const filtrados = todosLosRegalos.filter(r => r.nombre.toLowerCase().includes(txt) || r.descripcion.toLowerCase().includes(txt));
            mostrarRegalos(filtrados);
        }

        function abrirModal(id, nombre) {
            document.getElementById('reservaModal').style.display = 'flex';
            document.getElementById('selectedRegaloId').value = id;
            document.getElementById('nombreRegaloModal').textContent = nombre;
        }
        function cerrarModal() { document.getElementById('reservaModal').style.display = 'none'; }

        function enviarReserva() {
            const id = document.getElementById('selectedRegaloId').value;
            const nombre = document.getElementById('nombrePersona').value;
            const correo = document.getElementById('correoPersona').value;
            const btn = document.getElementById('btnConfirmar');

            if (!nombre || !correo.includes('@')) { alert("Por favor completa los datos correctamente."); return; }

            btn.disabled = true;
            btn.textContent = "Procesando...";

            fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors', 
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ id: id, nombre: nombre, correo: correo })
            })
            .then(() => {
                // AQU√ç OCURRE LA MAGIA:
                // 1. Cerramos el formulario
                document.getElementById('reservaModal').style.display = 'none';
                // 2. Abrimos el modal de √©xito bonito
                document.getElementById('exitoModal').style.display = 'flex';
            })
            .catch(error => {
                alert("Error de conexi√≥n: " + error);
                btn.disabled = false;
                btn.textContent = "Confirmar Reserva";
            });
        }
    </script>
</body>
</html>
